---
title: "GridDER: Grid Detection and Evaluation in R"
author: "Feng et al. 2022"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
    rmarkdown::html_vignette:
        toc: true
        number_sections: true
    md_document:
      variant: gfm
vignette: >
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{GridDER: Grid Detection and Evaluation in R}
  %\VignetteEngine{knitr::rmarkdown}
    \usepackage[utf8]{inputenc}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE) # for development
```

```{r load, echo = FALSE, eval = TRUE, include=FALSE}
devtools::load_all() # for development
```


<br/><br/>

# Introduction

## Main features and workflow


# Installation and presetting steps

Requirements 
_Phyton > 3.5 
-Earth ENgine account and credentials

As the package uses rgee (R package to acessess Google Earth Engine API), the following commands must be executed:

##### Step 1 

Create virtual environmental to install the necessary dependencies

```{r venv, echo=TRUE, eval=FALSE}
rgee::ee_install()
```

If the following message happen :
`An error occur when ee_install was creating the Python Environment. Run ee_clean_pyenv() and restart the R session, before trying again`

Then execute the bellow command and restart R session:

```{r ee_clean_pyenv, echo=TRUE, eval=FALSE}
rgee::ee_clean_pyenv()
```

After that you must run Step 1

Tou will resuest to continues and Rstart R seccion choose Yes in both cases 


##### Initialize

The follow command authorizes rgee to manage Earth Engine resources

```{r initialize, echo=TRUE, eval=FALSE}
rgee::ee_Initialize()
```
##### Check

```{r ee_check, echo=TRUE, eval=FALSE}
rgee::ee_check()
```

# Funtions

## assess_env_uncertainty 

##### Load ImageCollection of interest (environmental layer)

```{r add image, echo=TRUE, eval=TRUE}

rgee::ee_Initialize()
nasadem<- rgee::ee$Image('NASA/NASADEM_HGT/001')$select('elevation')
```

##### Create hypothetical grid system

```{r grid, echo=TRUE, eval= TRUE}
lat_lon_grid <- structure(list(ID = 758432:758443,
                              lat = c(-14.875, -14.875, -14.625, -14.625, -14.875, -14.875, -14.625, -14.625, -14.375, -14.375, -14.125, -14.125),
                              lon = c(-42.875, -42.625, -42.625, -42.875, -42.375, -42.125, -42.125, -42.375, -42.375, -42.125, -42.125, -42.375)),
                         class = "data.frame", row.names = c(NA, -12L))

grid_to_raster <- raster::rasterFromXYZ(lat_lon_grid [, c('lon', 'lat', 'ID')], crs = '+proj=longlat +datum=WGS84 +no_defs')

grid <- raster::rasterToPolygons(grid_to_raster, fun=NULL, na.rm=TRUE, dissolve=FALSE) |>
 sf::st_as_sf() |>
 rgee::sf_as_ee()

```

#### Plot 
The hypothetical grid is located in Brazil. Use zoom in tool to view. 

```{r plot, echo=TRUE, eval=TRUE, results='asis', out.width= "100%"}
rgee::Map$addLayer(grid)
```

#### Compute standard deviation
```{r, std_dev, echo=TRUE, eval=TRUE}
std_dev <- gridder::assess_env_uncertainty(x= nasadem, y= grid)

knitr::kable(std_dev)
```
 

## assess_sp_uncertainty
